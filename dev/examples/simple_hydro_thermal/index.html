<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hydro-thermal scheduling · SDDP.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../logo.ico" rel="icon" type="image/x-icon"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SDDP.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">SDDP.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">How-to guides</span><ul><li><a class="tocitem" href="../../guides/add_a_multidimensional_state_variable/">Add a multi-dimensional state variable</a></li><li><a class="tocitem" href="../../guides/add_a_risk_measure/">Add a risk measure</a></li><li><a class="tocitem" href="../../guides/add_multidimensional_noise_Terms/">Add multi-dimensional noise terms</a></li><li><a class="tocitem" href="../../guides/add_noise_in_the_constraint_matrix/">Add noise in the constraint matrix</a></li><li><a class="tocitem" href="../../guides/choose_a_stopping_rule/">Choose a stopping rule</a></li><li><a class="tocitem" href="../../guides/create_a_general_policy_graph/">Create a general policy graph</a></li><li><a class="tocitem" href="../../guides/debug_a_model/">Debug a model</a></li><li><a class="tocitem" href="../../guides/improve_computational_performance/">Improve computational performance</a></li><li><a class="tocitem" href="../../guides/simulate_using_a_different_sampling_scheme/">Simulate using a different sampling scheme</a></li><li><a class="tocitem" href="../../guides/upgrade_from_the_old_sddp/">Upgrade from the old SDDP.jl</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorial/01_first_steps/">Basic I: first steps</a></li><li><a class="tocitem" href="../../tutorial/02_adding_uncertainty/">Basic II: adding uncertainty</a></li><li><a class="tocitem" href="../../tutorial/03_objective_uncertainty/">Basic III: objective uncertainty</a></li><li><a class="tocitem" href="../../tutorial/04_markov_uncertainty/">Basic IV: Markov uncertainty</a></li><li><a class="tocitem" href="../../tutorial/05_plotting/">Basic V: plotting</a></li><li><a class="tocitem" href="../../tutorial/06_warnings/">Basic VI: words of warning</a></li><li><a class="tocitem" href="../../tutorial/11_objective_states/">Advanced I: objective states</a></li><li><a class="tocitem" href="../../tutorial/12_belief_states/">Advanced II: belief states</a></li><li><a class="tocitem" href="../../tutorial/13_integrality/">Advanced III: integrality</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Hydro-thermal scheduling</a><ul class="internal"><li><a class="tocitem" href="#Problem-Description-1"><span>Problem Description</span></a></li><li><a class="tocitem" href="#Importing-packages-1"><span>Importing packages</span></a></li><li><a class="tocitem" href="#Constructing-the-policy-graph-1"><span>Constructing the policy graph</span></a></li><li><a class="tocitem" href="#Constructing-the-model-1"><span>Constructing the model</span></a></li><li><a class="tocitem" href="#Training-the-policy-1"><span>Training the policy</span></a></li><li><a class="tocitem" href="#Simulating-the-policy-1"><span>Simulating the policy</span></a></li><li><a class="tocitem" href="#Extracting-the-water-values-1"><span>Extracting the water values</span></a></li></ul></li><li><a class="tocitem" href="../the_farmers_problem/">The farmer&#39;s problem</a></li></ul></li><li><a class="tocitem" href="../../apireference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Hydro-thermal scheduling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hydro-thermal scheduling</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/odow/SDDP.jl/blob/master/docs/src/examples/simple_hydro_thermal.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Hydro-thermal-scheduling-1"><a class="docs-heading-anchor" href="#Hydro-thermal-scheduling-1">Hydro-thermal scheduling</a><a class="docs-heading-anchor-permalink" href="#Hydro-thermal-scheduling-1" title="Permalink"></a></h1><h2 id="Problem-Description-1"><a class="docs-heading-anchor" href="#Problem-Description-1">Problem Description</a><a class="docs-heading-anchor-permalink" href="#Problem-Description-1" title="Permalink"></a></h2><p>In a hydro-thermal problem, the agent controls a hydro-electric generator and reservoir. Each time period, they need to choose a generation quantity from thermal <code>g_t</code>, and hydro <code>g_h</code>, in order to meed demand <code>w_d</code>, which is a stagewise-independent random variable. The state variable, <code>x</code>, is the quantity of water in the reservoir at the start of each time period, and it has a minimum level of 5 units and a maximum level of 15 units. We assume that there are 10 units of water in the reservoir at the start of time, so that <code>x_0 = 10</code>. The state-variable is connected through time by the water balance constraint: <code>x.out = x.in - g_t - s + w_i,</code> where <code>x.out</code> is the quantity of water at the end of the time period, <code>x.in</code> is the quantity of water at the start of the time period, <code>s</code> is the quantity of water spilled from the reservoir, and <code>w_i</code> is a stagewise-independent random variable that represents the inflow into the reservoir during the time period.</p><p>We assume that there are three stages, <code>t=1, 2, 3</code>, representing summer-fall, winter, and spring, and that we are solving this problem in an infinite-horizon setting with a discount factor of <code>0.95</code>.</p><p>In each stage, the agent incurs the cost of spillage, plus the cost of thermal generation. We assume that the cost of thermal generation is dependent on the stage <code>t = 1, 2, 3</code>, and that in each stage, <code>w</code> is drawn from the set <code>(w_i, w_d) = {(0, 7.5), (3, 5), (10, 2.5)}</code> with equal probability.</p><h2 id="Importing-packages-1"><a class="docs-heading-anchor" href="#Importing-packages-1">Importing packages</a><a class="docs-heading-anchor-permalink" href="#Importing-packages-1" title="Permalink"></a></h2><p>For this example, in addition to <code>SDDP</code>, we need <code>GLPK</code> as a solver and <code>Statisitics</code> to compute the mean of our simulations.</p><pre><code class="language-julia">using GLPK
using SDDP
using Statistics</code></pre><h2 id="Constructing-the-policy-graph-1"><a class="docs-heading-anchor" href="#Constructing-the-policy-graph-1">Constructing the policy graph</a><a class="docs-heading-anchor-permalink" href="#Constructing-the-policy-graph-1" title="Permalink"></a></h2><p>There are three stages in our problem, so we construct a linear policy graph with three stages using <a href="../../apireference/#SDDP.LinearGraph"><code>SDDP.LinearGraph</code></a>:</p><pre><code class="language-julia">graph = SDDP.LinearGraph(3)</code></pre><pre><code class="language-none">Root
 0
Nodes
 1
 2
 3
Arcs
 0 =&gt; 1 w.p. 1.0
 1 =&gt; 2 w.p. 1.0
 2 =&gt; 3 w.p. 1.0
</code></pre><p>Then, because we want to solve an infinite-horizon problem, we add an additional edge between node <code>3</code> and node <code>1</code> with probability <code>0.95</code>:</p><pre><code class="language-julia">SDDP.add_edge(graph, 3 =&gt; 1, 0.95)</code></pre><h2 id="Constructing-the-model-1"><a class="docs-heading-anchor" href="#Constructing-the-model-1">Constructing the model</a><a class="docs-heading-anchor-permalink" href="#Constructing-the-model-1" title="Permalink"></a></h2><p>Much of the macro code (i.e., lines starting with <code>@</code>) in the first part of the following should be familiar to users of JuMP.</p><p>Inside the <code>do-end</code> block (if this isn&#39;t familiar, see <a href="../../tutorial/01_first_steps/#What&#39;s-this-weird-do-syntax?-1">What&#39;s this weird <code>do</code> syntax?</a>), <code>sp</code> is a standard JuMP model, and <code>t</code> is an index for the state variable that will be called with <code>t = 1, 2, 3</code>.</p><p>The state variable <code>x</code>, constructed by passing the <code>SDDP.State</code> tag to <code>@variable</code> is actually a Julia struct with two fields: <code>x.in</code> and <code>x.out</code> corresponding to the incoming and outgoing state variables respectively. Both <code>x.in</code> and <code>x.out</code> are standard JuMP variables. The <code>initial_value</code> keyword provides the value of the state variable in the root node (i.e., <code>x_0</code>).</p><p>Compared to a JuMP model, one key difference is that we use <a href="../../apireference/#SDDP.@stageobjective"><code>@stageobjective</code></a> instead of <code>@objective</code>. The <a href="../../apireference/#SDDP.parameterize"><code>SDDP.parameterize</code></a> function takes a list of supports for <code>w</code> and parameterizes the JuMP model <code>sp</code> by setting the right-hand sides of the appropriate constraints (note how the constraints initially have a right-hand side of <code>0</code>). By default, it is assumed that the realizations have uniform probability, but a probability mass vector can also be provided.</p><pre><code class="language-julia">model = SDDP.PolicyGraph(
  graph, sense = :Min, lower_bound = 0.0, optimizer = with_optimizer(GLPK.Optimizer)
) do sp, t
  @variable(sp, 5 &lt;= x &lt;= 15, SDDP.State, initial_value = 10)
  @variable(sp, g_t &gt;= 0)
  @variable(sp, g_h &gt;= 0)
  @variable(sp, s &gt;= 0)
  @constraint(sp, balance, x.out - x.in + g_h + s == 0)
  @constraint(sp, demand, g_h + g_t == 0)
  @stageobjective(sp, s + t * g_t)
  SDDP.parameterize(sp, [[0, 7.5], [3, 5], [10, 2.5]]) do w
    set_normalized_rhs(balance, w[1])
    set_normalized_rhs(demand, w[2])
  end
end</code></pre><pre><code class="language-none">A policy graph with 3 nodes.
 Node indices: 1, 2, 3
</code></pre><h2 id="Training-the-policy-1"><a class="docs-heading-anchor" href="#Training-the-policy-1">Training the policy</a><a class="docs-heading-anchor-permalink" href="#Training-the-policy-1" title="Permalink"></a></h2><p>Once a model has been constructed, the next step is to train the policy. This can be achieved using <a href="../../apireference/#SDDP.train"><code>SDDP.train</code></a>. There are many options that can be passed, but <code>iteration_limit</code> terminates the training after the prescribed number of SDDP iterations.</p><pre><code class="language-julia">SDDP.train(model, iteration_limit = 100)</code></pre><pre><code class="language-none">--------------------------------------------------------------------------------
                      SDDP.jl (c) Oscar Dowson, 2017-20

Numerical stability report
  Non-zero Matrix range     [1e+00, 1e+00]
  Non-zero Objective range  [1e+00, 3e+00]
  Non-zero Bounds range     [5e+00, 2e+01]
  Non-zero RHS range        [3e+00, 1e+01]
No problems detected

Solver: serial mode

 Iteration    Simulation       Bound         Time (s)    Proc. ID   # Solves
        1    5.950000e+01   2.959255e+01   3.021531e-01          1         63
        2    4.030000e+02   7.909168e+01   3.110511e-01          1        342
        3    9.250000e+01   9.693990e+01   3.139522e-01          1        429
        4    6.610178e+02   1.738563e+02   3.395500e-01          1       1116
        5    3.065000e+02   1.907487e+02   3.668971e-01          1       1431
        6    2.661809e+02   1.966225e+02   3.750162e-01          1       1614
        7    1.710000e+02   2.017914e+02   3.824322e-01          1       1773
        8    1.079783e+01   2.023891e+02   3.832381e-01          1       1788
        9    1.637834e+02   2.090263e+02   3.935542e-01          1       2019
       10    1.337878e+02   2.106458e+02   4.004800e-01          1       2166
       11    2.712315e+02   2.158776e+02   4.154961e-01          1       2445
       12    5.840409e+01   2.167844e+02   4.189720e-01          1       2508
       13    1.130776e+02   2.182966e+02   4.239862e-01          1       2595
       14    6.251212e+02   2.237639e+02   4.647920e-01          1       3270
       15    4.063085e+01   2.244342e+02   4.672201e-01          1       3309
       16    1.006260e+02   2.246653e+02   4.714792e-01          1       3372
       17    6.219050e+01   2.251299e+02   4.752991e-01          1       3435
       18    5.233497e+02   2.284269e+02   5.103922e-01          1       3978
       19    3.987475e+02   2.296491e+02   5.526872e-01          1       4377
       20    1.894838e+02   2.302905e+02   5.634592e-01          1       4524
       21    5.048895e+02   2.310508e+02   5.920081e-01          1       4911
       22    6.342975e+01   2.314962e+02   6.051440e-01          1       5082
       23    6.736241e+00   2.314962e+02   6.062291e-01          1       5097
       24    1.079272e+02   2.318817e+02   6.188712e-01          1       5268
       25    2.768174e+02   2.321232e+02   6.411772e-01          1       5559
       26    1.627945e+02   2.327882e+02   6.599841e-01          1       5814
       27    1.893238e+02   2.329090e+02   6.724112e-01          1       5973
       28    3.332259e+02   2.336251e+02   7.022221e-01          1       6336
       29    9.440343e+01   2.336251e+02   7.063432e-01          1       6387
       30    9.238376e+02   2.347218e+02   7.872610e-01          1       7338
       31    2.135613e+02   2.348518e+02   8.173282e-01          1       7521
       32    1.551577e+01   2.348574e+02   8.195992e-01          1       7548
       33    5.350031e+01   2.349802e+02   8.341620e-01          1       7707
       34    1.112066e+02   2.349803e+02   8.408141e-01          1       7782
       35    1.367450e+02   2.350496e+02   8.466101e-01          1       7845
       36    3.026511e+02   2.352498e+02   8.773122e-01          1       8160
       37    3.624806e+02   2.353698e+02   9.151261e-01          1       8559
       38    1.740301e+02   2.354586e+02   9.281852e-01          1       8694
       39    7.582740e+01   2.354709e+02   9.354482e-01          1       8769
       40    1.930648e+02   2.355622e+02   9.596841e-01          1       9024
       41    1.117228e+02   2.355940e+02   9.687302e-01          1       9111
       42    1.228404e+02   2.356124e+02   9.772081e-01          1       9198
       43    6.893229e+01   2.356454e+02   9.820392e-01          1       9249
       44    4.525490e+02   2.356802e+02   1.028843e+00          1       9720
       45    3.564627e+02   2.358075e+02   1.067255e+00          1      10095
       46    1.999181e+02   2.358644e+02   1.092425e+00          1      10338
       47    1.691495e+02   2.359020e+02   1.127123e+00          1      10545
       48    9.134225e+01   2.359067e+02   1.135064e+00          1      10620
       49    3.870809e+02   2.359992e+02   1.171663e+00          1      10959
       50    9.374518e+01   2.360002e+02   1.179481e+00          1      11034
       51    3.203769e+01   2.360209e+02   1.184990e+00          1      11085
       52    1.696540e+02   2.360295e+02   1.205804e+00          1      11280
       53    6.705062e+01   2.360645e+02   1.218139e+00          1      11391
       54    1.246938e+03   2.361469e+02   1.356678e+00          1      12582
       55    6.197661e+02   2.362124e+02   1.431066e+00          1      13197
       56    2.427629e+01   2.362135e+02   1.435611e+00          1      13236
       57    5.472058e+01   2.362260e+02   1.445871e+00          1      13323
       58    5.959374e+01   2.362265e+02   1.452147e+00          1      13374
       59    3.424454e+02   2.362652e+02   1.525036e+00          1      13869
       60    2.352393e+02   2.362710e+02   1.546396e+00          1      14040
       61    1.375185e+02   2.362844e+02   1.564401e+00          1      14175
       62    2.596543e+02   2.362926e+02   1.590678e+00          1      14382
       63    1.939491e+02   2.362992e+02   1.611176e+00          1      14541
       64    4.247823e+01   2.363049e+02   1.617252e+00          1      14592
       65    1.001687e+01   2.363052e+02   1.623531e+00          1      14643
       66    5.165358e+02   2.363279e+02   1.691905e+00          1      15174
       67    2.490764e+01   2.363279e+02   1.695532e+00          1      15201
       68    2.415298e+02   2.363444e+02   1.741340e+00          1      15552
       69    3.934616e+02   2.363474e+02   1.782234e+00          1      15855
       70    1.364978e+02   2.363554e+02   1.800347e+00          1      15990
       71    1.214123e+02   2.363566e+02   1.812017e+00          1      16077
       72    1.845895e+02   2.363599e+02   1.833843e+00          1      16236
       73    5.925381e+02   2.363722e+02   1.923681e+00          1      16779
       74    5.962033e+01   2.363729e+02   1.936285e+00          1      16866
       75    2.885141e+02   2.363792e+02   1.971895e+00          1      17109
       76    3.731091e+02   2.363820e+02   2.025316e+00          1      17484
       77    1.499661e+02   2.363877e+02   2.052014e+00          1      17667
       78    7.200294e+02   2.363916e+02   2.155663e+00          1      18366
       79    7.799096e+01   2.363952e+02   2.172571e+00          1      18477
       80    4.985713e+00   2.363952e+02   2.176540e+00          1      18504
       81    5.001441e+01   2.363968e+02   2.193548e+00          1      18615
       82    4.649762e+01   2.363974e+02   2.199216e+00          1      18654
       83    8.899572e+01   2.363990e+02   2.213982e+00          1      18753
       84    2.195280e+02   2.364003e+02   2.249512e+00          1      18984
       85    1.010071e+02   2.364021e+02   2.269210e+00          1      19107
       86    6.776321e+02   2.364049e+02   2.406725e+00          1      19878
       87    4.148918e+01   2.364072e+02   2.414561e+00          1      19929
       88    8.699110e+01   2.364080e+02   2.430200e+00          1      20028
       89    2.214854e+02   2.364096e+02   2.461556e+00          1      20223
       90    2.035298e+02   2.364105e+02   2.492444e+00          1      20418
       91    8.500015e+01   2.364107e+02   2.513299e+00          1      20553
       92    2.134995e+02   2.364132e+02   2.553390e+00          1      20796
       93    2.530287e+02   2.364152e+02   2.586112e+00          1      21003
       94    1.590020e+02   2.364155e+02   2.616110e+00          1      21198
       95    7.650057e+01   2.364168e+02   2.623633e+00          1      21249
       96    2.505015e+02   2.364181e+02   2.656181e+00          1      21444
       97    2.425007e+02   2.364188e+02   2.711782e+00          1      21747
       98    9.559951e+02   2.364220e+02   2.879307e+00          1      22638
       99    2.175102e+02   2.364225e+02   2.914006e+00          1      22845
      100    3.449970e+02   2.364248e+02   2.993543e+00          1      23304

Terminating training with status: iteration_limit
------------------------------------------------------------------------------</code></pre><h2 id="Simulating-the-policy-1"><a class="docs-heading-anchor" href="#Simulating-the-policy-1">Simulating the policy</a><a class="docs-heading-anchor-permalink" href="#Simulating-the-policy-1" title="Permalink"></a></h2><p>After training, we can simulate the policy using <a href="../../apireference/#SDDP.simulate"><code>SDDP.simulate</code></a>.</p><pre><code class="language-julia">sims = SDDP.simulate(model, 100, [:g_t])
mu = round(mean([s[1][:g_t] for s in sims]), digits = 2)
println(&quot;On average, $(mu) units of thermal are used in the first stage.&quot;)</code></pre><pre><code class="language-none">On average, 2.5 units of thermal are used in the first stage.</code></pre><h2 id="Extracting-the-water-values-1"><a class="docs-heading-anchor" href="#Extracting-the-water-values-1">Extracting the water values</a><a class="docs-heading-anchor-permalink" href="#Extracting-the-water-values-1" title="Permalink"></a></h2><p>Finally, we can use <a href="../../apireference/#SDDP.ValueFunction"><code>SDDP.ValueFunction</code></a> and <a href="../../apireference/#SDDP.evaluate"><code>SDDP.evaluate</code></a> to obtain and evaluate the value function at different points in the state-space. Note that since we are minimizing, the price has a negative sign: each additional unit of water leads to a decrease in the the expected long-run cost.</p><pre><code class="language-julia">V = SDDP.ValueFunction(model[1])
cost, price = SDDP.evaluate(V, x = 10)</code></pre><pre><code class="language-none">(233.5507020825126, Dict(:x=&gt;-0.659927))</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../tutorial/13_integrality/">« Advanced III: integrality</a><a class="docs-footer-nextpage" href="../the_farmers_problem/">The farmer&#39;s problem »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 8 February 2020 20:19">Saturday 8 February 2020</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
